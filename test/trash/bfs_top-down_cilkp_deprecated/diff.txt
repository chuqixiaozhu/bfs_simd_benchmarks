139,147c139,152
< 		cilk_for (unsigned i = 0; i < out_degree; ++i) {
< 			unsigned end = start.get_out_neighbor(i);
< 			bool unvisited = __sync_bool_compare_and_swap(parents + end, (unsigned) -1, start_id); //update parents
< 			if (unvisited) {
< 				//new_frontier_tmp[offset + size++] = end;
< 				new_frontier_tmp[offset + i] = end;
< 			} else {
< 				new_frontier_tmp[offset + i] = (unsigned) -1;
< 				//new_frontier_tmp[offset + size++] = (unsigned) -1;
---
> 			cilk_for (unsigned i = 0; i < out_degree; ++i) {
> 				unsigned end = start.get_out_neighbor(i);
> 				if ((unsigned)-1 == parents[end]) {
> 					bool unvisited = __sync_bool_compare_and_swap(parents + end, (unsigned) -1, start_id); //update parents
> 					if (unvisited) {
> 						//new_frontier_tmp[offset + size++] = end;
> 						new_frontier_tmp[offset + i] = end;
> 					} else {
> 						new_frontier_tmp[offset + i] = (unsigned) -1;
> 						//new_frontier_tmp[offset + size++] = (unsigned) -1;
> 					}
> 				} else {
> 					new_frontier_tmp[offset + i] = (unsigned) -1;
> 				}
149d153
< 		}
151,159c155,168
< 		for (unsigned i = 0; i < out_degree; ++i) {
< 			unsigned end = start.get_out_neighbor(i);
< 			bool unvisited = __sync_bool_compare_and_swap(parents + end, (unsigned) -1, start_id); //update parents
< 			if (unvisited) {
< 				//new_frontier_tmp[offset + size++] = end;
< 				new_frontier_tmp[offset + i] = end;
< 			} else {
< 				new_frontier_tmp[offset + i] = (unsigned) -1;
< 				//new_frontier_tmp[offset + size++] = (unsigned) -1;
---
> 			for (unsigned i = 0; i < out_degree; ++i) {
> 				unsigned end = start.get_out_neighbor(i);
> 				if ((unsigned)-1 == parents[end]) {
> 					bool unvisited = __sync_bool_compare_and_swap(parents + end, (unsigned) -1, start_id); //update parents
> 					if (unvisited) {
> 						//new_frontier_tmp[offset + size++] = end;
> 						new_frontier_tmp[offset + i] = end;
> 					} else {
> 						new_frontier_tmp[offset + i] = (unsigned) -1;
> 						//new_frontier_tmp[offset + size++] = (unsigned) -1;
> 					}
> 				} else {
> 					new_frontier_tmp[offset + i] = (unsigned) -1;
> 				}
161d169
< 		}
